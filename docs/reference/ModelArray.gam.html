<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="`ModelArray.gam` fits gam model for each of elements requested, and returns a tibble data.frame of requested model statistics."><title>Run GAM for element-wise data — ModelArray.gam • ModelArray</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run GAM for element-wise data — ModelArray.gam"><meta property="og:description" content="`ModelArray.gam` fits gam model for each of elements requested, and returns a tibble data.frame of requested model statistics."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ModelArray</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/installations.html">Installation</a>
    <a class="dropdown-item" href="../articles/walkthrough.html">Example walkthrough</a>
    <a class="dropdown-item" href="../articles/container.html">Getting started with containers</a>
    <a class="dropdown-item" href="../articles/voxel-wise_data.html">Application to voxel-wise data</a>
    <a class="dropdown-item" href="../articles/doc_for_developer.html">Developer documentation</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run GAM for element-wise data</h1>
      
      <div class="d-none name"><code>ModelArray.gam.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>`ModelArray.gam` fits gam model for each of elements requested, and returns a tibble data.frame of requested model statistics.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ModelArray.gam</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">phenotypes</span>,</span>
<span>  <span class="va">scalar</span>,</span>
<span>  element.subset <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  full.outputs <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var.smoothTerms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"statistic"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>  var.parametricTerms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"estimate"</span>, <span class="st">"statistic"</span>, <span class="st">"p.value"</span><span class="op">)</span>,</span>
<span>  var.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dev.expl"</span><span class="op">)</span>,</span>
<span>  changed.rsq.term.index <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  correct.p.value.smoothTerms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fdr"</span><span class="op">)</span>,</span>
<span>  correct.p.value.parametricTerms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fdr"</span><span class="op">)</span>,</span>
<span>  num.subj.lthr.abs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  num.subj.lthr.rel <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  pbar <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>Formula (passed to `mgcv::gam()`)</p></dd>


<dt>data</dt>
<dd><p>ModelArray class</p></dd>


<dt>phenotypes</dt>
<dd><p>A data.frame of the cohort with columns of independent variables and covariates to be added to the model. It should contains a column called "source_file", and this column should match to that in <code>data</code>.</p></dd>


<dt>scalar</dt>
<dd><p>A character. The name of the element-wise scalar to be analysed</p></dd>


<dt>element.subset</dt>
<dd><p>A list of positive integers (min = 1, max = number of elements). The subset of elements you want to run. Default is `NULL`, i.e. requesting all elements in `data`.</p></dd>


<dt>full.outputs</dt>
<dd><p>TRUE or FALSE, Whether to return full set of outputs. If FALSE, it will only return those requested in arguments <code>var.*</code> and <code>correct.p.value.*</code>; if TRUE, arguments <code>var.*</code> will be ignored, and will return all possible statistics for <code>var.*</code> and any options requested in arguments <code>correct.p.value.*</code>.</p></dd>


<dt>var.smoothTerms</dt>
<dd><p>A list of characters. The list of variables to save for smooth terms (got from `broom::tidy(parametric = FALSE)`). Example smooth term: age in formula "outcome ~ s(age)". See "Details" section for more.</p></dd>


<dt>var.parametricTerms</dt>
<dd><p>A list of characters. The list of variables to save for parametric terms (got from `broom::tidy(parametric = TRUE)`). Example parametric term: sex in formula "outcome ~ s(age) + sex". See "Details" section for more.</p></dd>


<dt>var.model</dt>
<dd><p>A list of characters. The list of variables to save for the model (got from `broom::glance()` and `summary()`). See "Details" section for more.</p></dd>


<dt>changed.rsq.term.index</dt>
<dd><p>A list of (one or several) positive integers. Each element in the list means the i-th term of the formula's right hand side as the term of interest for changed R-squared between with and without it. Both delta adjusted R-squared and partial R-squared will be calculated for each of term requested. Usually term of interest is smooth term, or interaction term in models with interactions. See "Details" section for more, especially the "WARNING" in Details section for cases with caution!!</p></dd>


<dt>correct.p.value.smoothTerms</dt>
<dd><p>A list of characters. To perform and add a column for p.value correction for each smooth term. Default: "fdr". See "Details" section for more.</p></dd>


<dt>correct.p.value.parametricTerms</dt>
<dd><p>A list of characters. To perform and add a column for p.value correction for each parametric term. Default: "fdr". See "Details" section for more.</p></dd>


<dt>num.subj.lthr.abs</dt>
<dd><p>An integer, lower threshold of absolute number of subjects. For an element, if number of subjects who have finite values (defined by `is.finite()`, i.e. not NaN or NA or Inf) in h5 file &gt; <code>num.subj.lthr.abs</code>, then this element will be run normally; otherwise, this element will be skipped and statistical outputs will be set as NaN. Default is 10.</p></dd>


<dt>num.subj.lthr.rel</dt>
<dd><p>A value between 0-1, lower threshold of relative number of subjects. Similar to <code>num.subj.lthr.abs</code>, if proportion of subjects who have valid value &gt; <code>num.subj.lthr.rel</code>, then this element will be run normally; otherwise, this element will be skipped and statistical outputs will be set as NaN. Default is 0.2.</p></dd>


<dt>verbose</dt>
<dd><p>TRUE or FALSE, to print verbose messages or not</p></dd>


<dt>pbar</dt>
<dd><p>TRUE or FALSE, to print progress bar or not</p></dd>


<dt>n_cores</dt>
<dd><p>Positive integer, The number of CPU cores to run with</p></dd>


<dt>...</dt>
<dd><p>Additional arguments for `mgcv::gam()`</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Tibble with the summarized model statistics for all elements requested</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>You may request returning specific statistical variables by setting <code>var.*</code>, or you can get all by setting <code>full.outputs=TRUE</code>.
Note that statistics covered by <code>full.outputs</code> or <code>var.*</code> are the ones from broom::tidy(), broom::glance(), and summary() only, and do not include delta adjusted R-squared or partial R-squared or corrected p-values. However FDR-corrected p-values ("fdr") are generated by default.
List of acceptable statistic names for each of <code>var.*</code>:</p><ul><li><p><code>var.smoothTerms</code>: c("edf","ref.df","statistic","p.value"); For interpretation please see <a href="https://broom.tidymodels.org/reference/tidy.gam.html" class="external-link">tidy.gam</a> with `parametric=FALSE`.</p></li>
<li><p><code>var.parametricTerms</code>: c("estimate", "std.error","statistic","p.value"); For interpretation please see <a href="https://broom.tidymodels.org/reference/tidy.gam.html" class="external-link">tidy.gam</a> with `parametric=TRUE`.</p></li>
<li><p><code>var.model</code>: c("adj.r.squared","dev.expl", "sp.criterion", "scale", "df", "logLik","AIC", "BIC", "deviance", "df.residual", "nobs"); "adj.r.squared" is <code>r.sq</code> from <a href="https://rdrr.io/pkg/mgcv/man/summary.gam.html" class="external-link">summary.gam</a>; "sp.criterion" is <code>sp.criterion</code> from <a href="https://rdrr.io/pkg/mgcv/man/summary.gam.html" class="external-link">summary.gam</a>; For interpretation please see <a href="https://broom.tidymodels.org/reference/glance.gam.html" class="external-link">glance.gam</a> and <a href="https://rdrr.io/pkg/mgcv/man/summary.gam.html" class="external-link">summary.gam</a>.</p></li>
</ul><p>Regarding formula: So far these kinds of formula are tested:</p><ul><li><p>formula with smooth term, but without any interactions. Examples like <code>y ~ s(x) + orderedFactor</code>; <code>y ~ s(x) + s(z)</code></p></li>
<li><p>formula with interaction, but limited to only one interaction term, and in the formats of:</p><ul><li><p>Formula #1: <code>y ~ orderedFactor + s(x) + s(x, by=orderedFactor) + other_covariate</code>, where <code>orderedFactor</code> should be discrete variables and generated by `ordered`. The interaction term will be displayed as "s_x_BYorderedFactor" in the column name in returned data.frame. You may use function `generator_gamFormula_factorXsmooth()` to generate one.</p></li>
<li><p>Formula #2: <code>y ~ ti(x) + ti(z) + ti(x,z) + other_covariate</code>, where <code>x</code> and <code>z</code> should be continuous variables. The interaction term will be displayed as "ti_x_z" in the column name in the returned data.frame. You may use function `generator_gamFormula_continuousInteraction()` to generate one.</p></li>
</ul></li>
</ul><p>You may be interested in how important a term is in a model. We provide two ways of quantification (see below). Both of them require running the reduced model without this term of interest, thus it will take longer time to run. You can make such request via argument <code>changed.rsq.term.index</code>, and you'll get both quantifications.</p><ul><li><p>Delta adjusted R-squared (<code>delta.adj.rsq</code>) is defined as the difference between adjusted R-squared of full model (full formula in <code>formula</code>) and that of reduced model (formula without the term of interest). Notice that adjusted R-squared includes the penalty from the model complexity.</p></li>
<li><p>Partial R-squared (<code>partial.rsq</code>) is defined as: <code>(sse.reduced.model - sse.full.model) / sse.reduced.model</code>, where <code>sse</code> is the error sum of squares (or, residual sum of squares). It quantifies the amount of variance in the response variable that cannot be explained by the reduced model (model without term of interest), but can be explained by the term of interest in the full model.</p></li>
</ul><p><strong>___!!! WARNING !!!___</strong>: If you want to request <code>changed.rsq.term.index</code> for a term that has missing values, before feeding <code>phenotypes</code> into <code>ModelArray.gam()</code>, you must exclude those observations (i.e., those rows in <code>phenotypes</code>) who have missing values in this term of interest from <code>phenotypes</code>. 
You should do the same for each term you'd like to request in <code>changed.rsq.term.index</code>, if that term has missing values. 
Without such exclusion, the full and reduced models would include different number of subjects, causing inaccuracy of calculation of <code>delta.adj.rsq</code> and <code>partial.rsq</code>. <br><br>
Other notes on <code>changed.rsq.term.index</code>:</p><ul><li><p>When requesting <code>changed.rsq.term.index</code>, <code>fx</code> should be set as <code>TRUE</code>, so that degree of freedom is fixed.</p></li>
<li><p>For formula with interactions, only formula in above formats are tested, and only the values of interaction term are valid. The delta.adj.rsq and partial.rsq for main effect (such as s(x) in Formula #1) may not "functionally" be these metrics, as their definitions should be changed to reduced formula without both main effect and interaction term.</p></li>
</ul><p>For p-value corrections (arguments <code>correct.p.value.*</code>), supported methods include all methods in `p.adjust.methods` except "none". You can request more than one method. FDR-corrected p-values ("fdr") are calculated by default. Turn it off by setting to "none".
Please notice that different from `ModelArray.lm`, there is no p.value for the GAM model, so no "correct.p.value.model" for GAM model. <br>
Arguments <code>num.subj.lthr.abs</code> and <code>num.subj.lthr.rel</code> are mainly for input data with subject-specific masks, i.e. currently only for volume data. For fixel-wise data, you may ignore these arguments.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Chenying Zhao, Tinashe Tapera, Matthew Cieslak, Theodore Satterthwaite.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

